---
import { getCollection } from 'astro:content';

// 获取所有的 Markdown 文件
const allPosts = await getCollection('posts');

// 过滤出标记为 timeline 的 Markdown 文件
const timelinePosts = allPosts.filter(post => post.data.timeline === true);

import LayoutDefault from '~/layouts/LayoutDefault.astro'

export const getStaticPaths = (async () => {
  const posts = await getPosts()
  return posts.map((post, idx) => {
    const prev = posts[idx - 1]
    const next = posts[idx + 1]
    return {
      params: { slug: post.slug },
      props: { entry: post, next, prev },
    }
  })
}) satisfies GetStaticPaths

<LayoutDefault>
  <SiteSeo slot="seo" title={entry.data.title} desc={entry.data.description} banner={entry.data.banner} />

  <LayoutPost post={entry}>
    <Content />
  </LayoutPost>

  <Pagination
    showLeft={Boolean(prev)}
    leftTitle={`${t('prev_post')}: ${prev?.data.title}`}
    leftUrl={getUrl(prev?.slug)}
    showRight={Boolean(next)}
    rightTitle={`${t('next_post')}: ${next?.data.title}`}
    rightUrl={getUrl(next?.slug)}
    showPageCount={false}
  />

  <Comments post={entry} />
</LayoutDefault>

<script>
  import '@github/clipboard-copy-element'

  document.addEventListener('clipboard-copy', (event) => {
    const target = event.target as HTMLElement
    const icon = target.querySelector('.icon') as HTMLElement
    icon.classList.replace('i-mdi-content-copy', 'i-mdi-check')
    setTimeout(() => {
      icon.classList.replace('i-mdi-check', 'i-mdi-content-copy')
    }, 1500)
  })

  const codeBlocks = Array.from(document.querySelectorAll('pre'))
  const icon = "<div class='i-mdi-content-copy icon text-white'></div>"
  for (const codeBlock of codeBlocks) {
    const wrapper = document.createElement('div')
    wrapper.className = 'code-container'

    const copyButton = document.createElement('clipboard-copy')
    const code = codeBlock.querySelector('code')
    copyButton.value = code?.textContent ?? ''
    copyButton.className = 'clipboard-copy'
    copyButton.innerHTML = icon

    codeBlock.appendChild(copyButton)

    codeBlock.parentNode?.insertBefore(wrapper, codeBlock)
    wrapper.appendChild(codeBlock)
  }
</script>

<style is:global>
  .code-container {
    position: relative;
  }
  .clipboard-copy {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    width: 1.75rem;
    height: 1.75rem;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 0.25rem;
  }

  .clipboard-copy:hover {
    background-color: #30363d;
  }
</style>

---



<html>
  <head>
    <title>动态页面</title>
    <style>
      .timeline {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .timeline-item {
        position: relative;
        margin: 2em 0;
        padding-left: 30px;
        border-left: 2px solid #ccc;
      }

      .timeline-item:before {
        content: '';
        position: absolute;
        left: -10px;
        top: 0;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #fff;
        border: 2px solid #ccc;
      }

      .timeline-title {
        margin: 0 0 0.5em;
        color: #333;
        font-size: 1.25em;
      }

      .timeline-content {
        line-height: 1.6;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="timeline">
      <h1>动态页面</h1>
      <ul style="list-style: none; padding: 0;">
        {timelinePosts.map(post => (
          <li class="timeline-item">
            <h2 class="timeline-title">{post.data.title}</h2>
            <article class="timeline-content">{post.body}</article>
          </li>
        ))}
      </ul>
    </div>
  </body>
</html>